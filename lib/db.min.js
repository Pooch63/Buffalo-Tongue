"use strict"
var __createBinding=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n)
var a=Object.getOwnPropertyDescriptor(e,n)
a&&!("get"in a?!e.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,a)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t
var e={}
if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&__createBinding(e,t,n)
return __setModuleDefault(e,t),e}
Object.defineProperty(exports,"__esModule",{value:!0}),exports.STRING=exports.DOUBLE=exports.INT=exports.Database=void 0
var Validation,Schema,colors=__importStar(require("colors/safe"))
function value_to_string(t){return"boolean"==typeof t?colors.yellow(t?"true":"false"):"number"==typeof t?colors.green(t.toString()):"string"==typeof t?colors.blue('"'.concat(t.replaceAll('"','\\"'),'"')):void 0}!function(t){t.is_int=function(t){return"number"==typeof t&&t==Math.floor(t)},t.is_double=function(t){return"number"==typeof t}}(Validation||(Validation={})),function(t){!function(t){t.INT="integer",t.DOUBLE="double",t.STRING="string",t.BOOLEAN="boolean"}(t.Datatype||(t.Datatype={})),t.validate_type=function(e){var n=e.value
switch(e.type){case t.Datatype.INT:if(!Validation.is_int(n))return!1
break
case t.Datatype.DOUBLE:if(!Validation.is_double(n))return!1
break
case t.Datatype.STRING:if("string"==typeof n)return!1
break
case t.Datatype.BOOLEAN:if("boolean"==typeof n)return!1
break
default:return!1}return!0}
t.Row=function(t){this.default=null,this.unique=!1,this.name=t.name,this.type=t.type,null!=t.unique&&(this.unique=t.unique),null!=t.default&&(this.default=t.default),this.validation=t.validation}
var e=function(){function e(e){var n=e.rows
this.unique_key=null
for(var i=[],a=0,r=n;a<r.length;a++){var o=r[a]
i.push(new t.Row(o))}for(var u={},l=0,s=i;l<s.length;l++){if(null!=u[(o=s[l]).name])throw new Error('Duplicate row "'.concat(o.name,'"'))
if(o.unique){if(null!=this.unique_key)throw new Error('Table may not have two unique keys. Rows "'.concat(this.unique_key,'" and "').concat(o.name,'" were both declared as unique.'))
this.unique_key=o.name}}this.rows=i}return e.prototype.validate=function(e){for(var n,i=0,a=this.rows;i<a.length;i++){var r=a[i],o=null!==(n=e[r.name])&&void 0!==n?n:r.default
if(!o)throw new Error('Unable to insert record -- row "'.concat(r.name,'" was not included, and no default exists.'))
if(!t.validate_type({value:o,type:r.type}))throw new Error('Column "'.concat(r.name,'" is not of valid type (valid type is of ').concat(r.type,")"))}return!0},e}()
t.Table=e,t.get_unique_key=function(t,e){return null==e.unique_key?null:t[e.unique_key]}}(Schema||(Schema={}))
var QueryCondition=function(){function t(t){this.conditions=[],this.row_limit=Number.POSITIVE_INFINITY,this.conditions.push(t)}return t.prototype.or=function(t){return this.conditions.push(t),this},t.prototype.limit=function(t){return this.row_limit=t,this},t.prototype.validate_against_condition=function(t){var e=t.row,n=t.condition
for(var i in n){var a=e[i],r=n[i]
if("object"!=typeof r)return a==r
if(r.not_eq&&a===r.not_eq)return!1
if(r.eq&&a!==r.eq)return!1
if(r.lt&&!("number"==typeof a&&a<r.lt))return!1
if(r.gt&&!("number"==typeof a&&a>r.gt))return!1
if(r.lte&&!("number"==typeof a&&a<=r.lte))return!1
if(r.gte&&!("number"==typeof a&&a>=r.gte))return!1}return!0},t.prototype.validate=function(e){for(var n=0,i=this.conditions;n<i.length;n++){var a=i[n]
if(a instanceof t){if(!a.validate(e))return!1}else if(!this.validate_against_condition({row:e,condition:a}))return!1}return!0},t}(),Table=function(){function t(t){var e=t.name,n=t.schema
this.data={},this.data_count=0,this.name=e,this.schema=n}return t.prototype.insert=function(t){if(!this.schema.validate(t))throw new Error('Record inserted into table "'.concat(this.name,'" did not match schema.'))
for(var e=0,n=this.schema.rows;e<n.length;e++)null==t[(o=n[e]).name]&&(t[o.name]=o.default)
var i=Schema.get_unique_key(t,this.schema)
if(null!=i&&null!=this.data[String(i)])throw new Error('Unique key "'.concat(i,'" has already been inserted.'))
for(var a=0,r=this.schema.rows;a<r.length;a++){var o
if("function"==typeof(o=r[a]).validation&&!o.validation(t[o.name]))throw new Error('Custom validation function declared that column "'.concat(o.name,'" was invalid (value was ').concat(value_to_string(t[o.name]),")"))}this.data[null==i?this.data_count:String(i)]=t,this.data_count+=1},t.prototype.each=function(t){for(var e in this.data)if(null!=this.data[e]&&0==t(this.data[e],e))break},t.prototype.filter=function(t){if(null!=this.schema.unique_key)for(var e in this.data)null!=this.data[e]&&(t(this.data[e],e)||(this.data[e]=null))
else{for(var n={},i=0,a=0;a<this.data_count;a+=1)t(this.data[a],a)||(n[i]=this.data[a],i+=1)
this.data=n,this.data_count=i}},t}(),Database=function(){function t(){this.tables={},this.create=this.create_table,this.distint=this.select_distinct}return t.prototype.get_table=function(t){if(null==this.tables[t])throw new Error('Table "'.concat(t,'" does not exist.'))
return this.tables[t]},t.prototype.create_table=function(t,e){var n=e instanceof Schema.Table?e:new Schema.Table({rows:e.rows})
this.tables[t]=new Table({name:t,schema:n})},t.prototype.insert_into_table=function(t,e){t.insert(e)},t.prototype.insert=function(t,e){this.insert_into_table(this.get_table(t),e)},t.prototype.select_from_table=function(t,e){if(null==e){var n=[]
return t.each((function(t){n.push(t)})),n}var i=[]
return t.each((function(t){if(i.length>=e.row_limit)return!1
e.validate(t)&&i.push(t)})),i},t.prototype.select=function(t,e){if(null==this.tables[t])throw new Error('Table "'.concat(t,'" does not exist.'))
return this.select_from_table(this.tables[t],null==e?null:e instanceof QueryCondition?e:new QueryCondition(e))},t.prototype.select_count_from_table=function(t,e){if(null==e)return t.data_count
var n=0
return t.each((function(t){e.validate(t)&&(n+=1)})),n},t.prototype.select_count=function(t,e){if(null==this.tables[t])throw new Error('Table "'.concat(t,'" does not exist.'))
return this.select_count_from_table(this.tables[t],null==e?null:e instanceof QueryCondition?e:new QueryCondition(e))},t.prototype.delete_from_table=function(t,e){t.filter((function(t){return null==e||e.validate(t)}))},t.prototype.delete=function(t,e){this.delete_from_table(this.get_table(t),null==e?null:e instanceof QueryCondition?e:new QueryCondition(e))},t.prototype.select_distinct=function(){},t}()
exports.Database=Database,exports.INT=Schema.Datatype.INT,exports.DOUBLE=Schema.Datatype.DOUBLE,exports.STRING=Schema.Datatype.STRING
var db=new Database
db.create_table("users",{rows:[{name:"username",type:exports.STRING,unique:!0},{name:"age",type:exports.INT,unique:!1}]}),db.insert("users",{age:1.75,username:"Kiyaan"})

//# sourceMappingURL=./db.min.js.map